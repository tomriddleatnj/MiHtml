<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>职场西语大师 (Eptisa Edition)</title>
    <!-- 引入 Tailwind CSS (样式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM (核心库) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel (让浏览器能运行 React 代码) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 自定义滚动条 */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* 打印专用样式修正 */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            /* 强制重置滚动和定位，确保所有页面都能打印出来 */
            body, #root, .print-container { 
                position: relative !important; 
                height: auto !important; 
                overflow: visible !important; 
                inset: auto !important;
            }
            body { background: white; color: black; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans h-screen overflow-hidden flex">

    <!-- React 挂载点 -->
    <div id="root" class="w-full h-full flex"></div>

    <!-- React 逻辑代码 -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 图标组件 (SVG) ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                search: <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />,
                globe: <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />,
                building: <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />,
                hardhat: <path d="M2 22h20M12 2v10m-8 0h16M4 12a8 8 0 0116 0" />,
                chevronRight: <path d="M9 5l7 7-7 7" />,
                chevronDown: <path d="M19 9l-7 7-7-7" />,
                printer: <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2m-4 0v4H9v-4m0 0H6" />,
                refresh: <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />,
                check: <path d="M5 13l4 4L19 7" />,
                alert: <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />,
                file: <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />,
                x: <path d="M18 6L6 18M6 6l12 12" />,
                volume: <path d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />,
                filter: <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />,
                square: <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />,
                checkSquare: <path d="M9 11l3 3L22 4" />,
                menu: <path d="M4 6h16M4 12h16M4 18h16" />
            };
            
            // 简单的 Checkbox 图标逻辑
            if (name === 'checkbox_checked') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                        <polyline points="9 11 12 14 22 4" />
                    </svg>
                )
            }
            if (name === 'checkbox_unchecked') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    </svg>
                )
            }

            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        // --- 基础配置 ---
        const LEVELS = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
        
        const FILE_SLOTS = Array.from({ length: 100 }, (_, i) => {
            const fileId = i.toString().padStart(2, '0');
            let desc = `扩展槽位 ${fileId}`;
            if (i < 10) desc = '基础/通用 (00-09)';
            else if (i < 30) desc = '职能部门 (10-29)'; 
            else if (i < 60) desc = '专业领域 (30-59)';
            
            return {
                id: i,
                fileName: `${fileId}.json`,
                desc: desc
            };
        });

        const MENU_STRUCTURE = [
            {
                id: 'foundation', title: '职场基石', icon: 'globe',
                submenus: [
                    { id: 'life_basic', name: '生活基础 (Vida Diaria)', tag: 'basic' },
                    { id: 'office_gen', name: '办公室 (Oficina)', tag: 'office' },
                    { id: 'comm', name: '沟通 (Comunicación)', tag: 'comm' },
                ]
            },
            {
                id: 'corporate', title: '职能部门', icon: 'building',
                submenus: [
                    { id: 'dept_hr', name: '人力资源 (RRHH)', tag: 'hr' },
                    { id: 'dept_finance', name: '财务 (Finanzas)', tag: 'finance' },
                    { id: 'dept_legal', name: '法务 (Legal)', tag: 'legal' },
                    { id: 'dept_it', name: 'IT & 系统 (Sistemas)', tag: 'it' },
                    { id: 'dept_ops', name: '运营 (Operaciones)', tag: 'ops' },
                    { id: 'dept_mkt', name: '市场营销 (Marketing)', tag: 'marketing' },
                    { id: 'dept_bd', name: '商务拓展 (Desarrollo)', tag: 'bd' },
                    { id: 'dept_procurement', name: '采购 (Compras)', tag: 'procurement' },
                    { id: 'dept_qhse', name: '质量安全 (Calidad/HSE)', tag: 'qhse' },
                ]
            },
            {
                id: 'domain', title: '工程咨询', icon: 'hardhat',
                submenus: [
                    { id: 'dom_pm', name: '项目管理 (Gestión)', tag: 'pm' },
                    { id: 'dom_bid', name: '招投标 (Licitaciones)', tag: 'bidding' },
                    { id: 'dom_supervision', name: '工程监理 (Supervisión)', tag: 'supervision' },
                    { id: 'dom_water', name: '水务 (Agua)', tag: 'water' },
                    { id: 'dom_transport', name: '综合交通 (Transporte)', tag: 'transport' },
                    { id: 'dom_rail', name: '铁路轨道 (Ferrocarriles)', tag: 'rail' },
                    { id: 'dom_roads', name: '道路桥梁 (Carreteras)', tag: 'roads' },
                    { id: 'dom_airport', name: '机场航空 (Aeropuertos)', tag: 'airport' },
                    { id: 'dom_ports', name: '港口海事 (Puertos)', tag: 'ports' },
                    { id: 'dom_energy', name: '能源电力 (Energía)', tag: 'energy' },
                    { id: 'dom_urban', name: '建筑规划 (Urbanismo)', tag: 'urban' },
                    { id: 'dom_geo', name: '地质岩土 (Geotecnia)', tag: 'geo' },
                    { id: 'dom_env', name: '环境生态 (Medio Ambiente)', tag: 'environment' },
                ]
            }
        ];

        // --- 主组件 ---
        function App() {
            const [words, setWords] = useState([]);
            
            // 筛选状态 (多选)
            const [selectedTags, setSelectedTags] = useState([]); // 空数组代表全选
            const [selectedLevels, setSelectedLevels] = useState([]); // 空数组代表全选
            
            const [searchTerm, setSearchTerm] = useState('');
            const [expandedMenus, setExpandedMenus] = useState(['foundation', 'corporate', 'domain']);
            const [isPrintMode, setIsPrintMode] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [fileStatus, setFileStatus] = useState({});
            const [showStatusModal, setShowStatusModal] = useState(false);
            const [loadedCount, setLoadedCount] = useState(0);

            // 移动端菜单状态
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

            // 加载逻辑
            const loadStaticFiles = async () => {
                setIsLoading(true);
                const newFileStatus = {};
                let allWords = [];
                let successCount = 0;
                
                const promises = FILE_SLOTS.map(async (slot) => {
                    try {
                        const response = await fetch(`vocab_data/${slot.fileName}?t=${Date.now()}`);
                        if (!response.ok) throw new Error('missing');
                        const data = await response.json();
                        
                        if (Array.isArray(data)) {
                            newFileStatus[slot.id] = { status: 'ok', count: data.length };
                            successCount++;
                            // 标记来源
                            return data.map(item => ({ ...item, sourceFile: slot.fileName }));
                        } else {
                            newFileStatus[slot.id] = { status: 'error', count: 0, msg: '格式错误' };
                            return [];
                        }
                    } catch (error) {
                        newFileStatus[slot.id] = { status: 'missing', count: 0 };
                        return [];
                    }
                });

                const results = await Promise.all(promises);
                results.forEach(w => allWords = [...allWords, ...w]);

                // 去重
                const uniqueMap = new Map();
                allWords.forEach(w => {
                    if(!w.es_term) return;
                    const key = w.es_term.toLowerCase();
                    if (uniqueMap.has(key)) {
                        const existing = uniqueMap.get(key);
                        const mergedTags = Array.from(new Set([...existing.tags, ...(w.tags || [])]));
                        // 合并所有属性 (如果新词有更详细的定义，优先使用新词，这里简单做属性合并)
                        const mergedWord = {
                            ...existing,
                            tags: mergedTags,
                            // 如果原有词没有level而新词有，则补充
                            level: existing.level || w.level,
                            context: existing.context || w.context,
                            phonetic: existing.phonetic || w.phonetic,
                            en_term: existing.en_term || w.en_term
                        };
                        uniqueMap.set(key, mergedWord);
                    } else {
                        uniqueMap.set(key, w);
                    }
                });

                setFileStatus(newFileStatus);
                setLoadedCount(successCount);
                setWords(Array.from(uniqueMap.values()));
                setIsLoading(false);
            };

            useEffect(() => { loadStaticFiles(); }, []);

            const handleSpeak = (text) => {
                if (!window.speechSynthesis) {
                    alert('您的浏览器不支持语音播放功能');
                    return;
                }
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            };

            // 菜单折叠切换
            const toggleMenu = (id) => {
                setExpandedMenus(prev => prev.includes(id) ? prev.filter(m => m !== id) : [...prev, id]);
            };

            // 标签切换 (多选)
            const toggleTag = (tag) => {
                if (tag === 'all') {
                    setSelectedTags([]);
                    return;
                }
                setSelectedTags(prev => {
                    if (prev.includes(tag)) return prev.filter(t => t !== tag);
                    return [...prev, tag];
                });
            };

            // 等级切换 (多选)
            const toggleLevel = (lvl) => {
                setSelectedLevels(prev => {
                    if (prev.includes(lvl)) return prev.filter(l => l !== lvl);
                    return [...prev, lvl];
                });
            };

            // 清空所有筛选
            const clearFilters = () => {
                setSelectedTags([]);
                setSelectedLevels([]);
                setSearchTerm('');
            };

            // 核心筛选逻辑
            const filteredWords = useMemo(() => {
                return words.filter(word => {
                    // 1. 标签筛选
                    const matchesTag = selectedTags.length === 0 || (word.tags && word.tags.some(t => selectedTags.includes(t)));
                    
                    // 2. 搜索筛选
                    const searchLower = searchTerm.toLowerCase();
                    const matchesSearch = 
                        (word.es_term && word.es_term.toLowerCase().includes(searchLower)) || 
                        (word.en_term && word.en_term.toLowerCase().includes(searchLower)) ||
                        (word.definition && word.definition.includes(searchLower));

                    // 3. 等级筛选
                    const wordLevel = word.level ? word.level.toUpperCase() : 'N/A';
                    const matchesLevel = selectedLevels.length === 0 || selectedLevels.includes(wordLevel);

                    return matchesTag && matchesSearch && matchesLevel;
                }).sort((a, b) => a.es_term.localeCompare(b.es_term));
            }, [words, selectedTags, selectedLevels, searchTerm]);

            // 打印视图
            if (isPrintMode) {
                return (
                    <div className="print-container fixed inset-0 z-50 bg-white overflow-y-auto custom-scrollbar text-black p-8 font-serif">
                        <div className="flex justify-between items-center mb-6 no-print">
                            <h2 className="text-2xl font-bold">打印预览 / Vista de Impresión</h2>
                            <div className="flex gap-4">
                                <button onClick={() => window.print()} className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">确认打印 (Print)</button>
                                <button onClick={() => setIsPrintMode(false)} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">返回 (Back)</button>
                            </div>
                        </div>
                        
                        <div className="mb-6 pb-4 border-b border-gray-300">
                            <h1 className="text-3xl font-bold uppercase tracking-wider mb-2">Glosario Español - Eptisa</h1>
                            <div className="text-sm text-gray-600 flex flex-wrap gap-4">
                                <div><span className="font-bold">Filtros Categoría:</span> {selectedTags.length > 0 ? selectedTags.join(', ') : 'Todas'}</div>
                                <div><span className="font-bold">Filtros Nivel:</span> {selectedLevels.length > 0 ? selectedLevels.join(', ') : 'Todos'}</div>
                                <div><span className="font-bold">Total:</span> {filteredWords.length}</div>
                            </div>
                        </div>

                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="border-b-2 border-black bg-gray-100 text-sm">
                                    <th className="p-2 w-1/4">Español</th>
                                    <th className="p-2 w-1/4">English / Definición</th>
                                    <th className="p-2 w-[40%]">Contexto</th>
                                    <th className="p-2 w-[10%] text-center">Nivel</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredWords.map((w, i) => (
                                    <tr key={i} className="border-b border-gray-300 break-inside-avoid">
                                        <td className="p-2 align-top">
                                            <div className="font-bold">{w.es_term}</div>
                                            <div className="text-xs text-gray-500">{w.phonetic}</div>
                                        </td>
                                        <td className="p-2 align-top">
                                            <div>{w.definition}</div>
                                            <div className="text-sm text-gray-600 italic">{w.en_term}</div>
                                        </td>
                                        <td className="p-2 align-top text-sm italic text-gray-700">
                                            {w.context}
                                        </td>
                                        <td className="p-2 align-top text-center font-bold">
                                            {w.level || '-'}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            }

            // 正常视图
            return (
                <div className="flex w-full h-full relative">
                    
                    {/* Mobile Menu Overlay */}
                    {isMobileMenuOpen && (
                        <div 
                            className="fixed inset-0 bg-black/50 z-30 md:hidden transition-opacity"
                            onClick={() => setIsMobileMenuOpen(false)}
                        ></div>
                    )}

                    {/* Sidebar */}
                    <div 
                        className={`fixed inset-y-0 left-0 z-40 w-72 bg-slate-900 text-slate-300 flex flex-col flex-shrink-0 shadow-xl transition-transform duration-300 ease-in-out md:static md:translate-x-0 ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}`}
                    >
                        <div className="p-4 bg-slate-950 border-b border-slate-800 flex justify-between items-center">
                            <div>
                                <div className="flex items-center gap-2 font-bold text-white text-lg">
                                    <Icon name="globe" className="text-yellow-500" />
                                    <span>Español Pro</span>
                                </div>
                                <div className="text-xs text-slate-500 mt-1">多选筛选 & 难度分级</div>
                            </div>
                            {/* Mobile Close Button */}
                            <button 
                                className="md:hidden text-slate-400 hover:text-white"
                                onClick={() => setIsMobileMenuOpen(false)}
                            >
                                <Icon name="x" size={24} />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-6">
                            
                            {/* Level Filter Section */}
                            <div>
                                <h3 className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">难度等级 (Nivel)</h3>
                                <div className="grid grid-cols-3 gap-2">
                                    {LEVELS.map(lvl => (
                                        <button 
                                            key={lvl}
                                            onClick={() => toggleLevel(lvl)}
                                            className={`py-1 px-2 text-xs rounded border transition-colors ${
                                                selectedLevels.includes(lvl) 
                                                ? 'bg-yellow-600 text-white border-yellow-600 font-bold' 
                                                : 'bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500'
                                            }`}
                                        >
                                            {lvl}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Category Filter Section */}
                            <div>
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="text-xs font-bold text-slate-500 uppercase tracking-wider">分类筛选 (Categorías)</h3>
                                    {(selectedTags.length > 0 || selectedLevels.length > 0) && (
                                        <button onClick={clearFilters} className="text-[10px] text-red-400 hover:text-red-300 underline">
                                            清除筛选
                                        </button>
                                    )}
                                </div>
                                
                                <div className="space-y-4">
                                    {MENU_STRUCTURE.map(section => (
                                        <div key={section.id}>
                                            <button 
                                                onClick={() => toggleMenu(section.id)} 
                                                className="w-full flex items-center justify-between py-1 text-xs font-bold uppercase tracking-wider text-slate-400 hover:text-white transition-colors"
                                            >
                                                <div className="flex items-center gap-2">
                                                    <Icon name={section.icon} size={14} />
                                                    {section.title}
                                                </div>
                                                <Icon name={expandedMenus.includes(section.id) ? "chevronDown" : "chevronRight"} size={12} />
                                            </button>
                                            
                                            {expandedMenus.includes(section.id) && (
                                                <div className="mt-2 space-y-1 ml-1 pl-2 border-l border-slate-700">
                                                    {section.submenus.map(sub => {
                                                        const isSelected = selectedTags.includes(sub.tag);
                                                        const count = words.filter(w => w.tags && w.tags.includes(sub.tag)).length;
                                                        return (
                                                            <button 
                                                                key={sub.id} 
                                                                onClick={() => toggleTag(sub.tag)} 
                                                                className={`w-full text-left pl-2 pr-2 py-1.5 text-sm rounded transition-all flex items-center justify-between group ${
                                                                    isSelected 
                                                                    ? 'bg-slate-800 text-yellow-400 font-medium' 
                                                                    : 'text-slate-400 hover:bg-slate-800 hover:text-white'
                                                                }`}
                                                            >
                                                                <div className="flex items-center gap-2">
                                                                    <Icon name={isSelected ? "checkbox_checked" : "checkbox_unchecked"} size={14} className={isSelected ? "text-yellow-500" : "text-slate-600"} />
                                                                    <span>{sub.name.split(' (')[0]}</span>
                                                                </div>
                                                                <span className={`text-[10px] px-1.5 rounded-full ${isSelected ? 'bg-yellow-900/30 text-yellow-500' : 'bg-slate-800 text-slate-600'}`}>{count}</span>
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        
                        <div className="p-4 bg-slate-950 border-t border-slate-800 space-y-2">
                            <button onClick={() => setShowStatusModal(true)} className="w-full flex items-center justify-between px-3 py-2 bg-slate-800 text-xs rounded hover:bg-slate-700 group">
                                <span>文件槽位状态</span>
                                <div className="flex gap-1 font-bold">
                                    <span className="text-green-500">{loadedCount}</span><span className="text-slate-600">/</span><span className="text-slate-500">100</span>
                                </div>
                            </button>
                            <button onClick={loadStaticFiles} className="w-full flex items-center justify-center gap-2 px-3 py-2 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700">
                                <Icon name="refresh" className={isLoading ? 'animate-spin' : ''} size={14} />
                                刷新数据
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col h-full overflow-hidden w-full">
                        <div className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 md:px-6 shadow-sm z-10">
                            
                            {/* Left Side: Menu Btn & Stats */}
                            <div className="flex items-center gap-2 md:gap-4 flex-1 overflow-hidden">
                                <button 
                                    className="md:hidden p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-full"
                                    onClick={() => setIsMobileMenuOpen(true)}
                                >
                                    <Icon name="menu" size={24} />
                                </button>

                                <div className="flex items-center gap-2 text-sm text-slate-500 overflow-x-auto whitespace-nowrap scrollbar-hide">
                                    <div className="flex items-center gap-1 flex-shrink-0">
                                        <span className="hidden md:inline font-bold text-slate-700">筛选:</span>
                                        <span className="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full text-xs font-bold">{filteredWords.length}</span>
                                    </div>
                                    {(selectedTags.length > 0 || selectedLevels.length > 0) && (
                                        <div className="flex gap-2">
                                            {selectedLevels.map(l => <span key={l} className="px-2 py-0.5 bg-slate-100 border border-slate-200 rounded-full text-xs">{l}</span>)}
                                            {selectedTags.map(t => <span key={t} className="px-2 py-0.5 bg-slate-100 border border-slate-200 rounded-full text-xs">{t}</span>)}
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* Right Side: Search & Print */}
                            <div className="flex items-center gap-2 md:gap-4 flex-shrink-0">
                                <div className="relative w-32 md:w-64">
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Icon name="search" size={16}/></div>
                                    <input type="text" placeholder="搜索..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-9 pr-4 py-1.5 bg-slate-100 border-transparent focus:bg-white border focus:border-yellow-500 rounded-md outline-none text-sm transition-all" />
                                </div>
                                <button onClick={() => setIsPrintMode(true)} className="hidden md:flex items-center gap-2 px-4 py-2 bg-slate-900 text-white text-sm font-medium rounded-md hover:bg-slate-800 shadow-md transition-transform active:scale-95">
                                    <Icon name="printer" size={18} /> <span className="hidden lg:inline">打印</span>
                                </button>
                                {/* Mobile Print Icon Only */}
                                <button onClick={() => setIsPrintMode(true)} className="md:hidden p-2 text-slate-600 bg-slate-100 rounded-md">
                                    <Icon name="printer" size={18} />
                                </button>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-50">
                            {filteredWords.length > 0 ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                                    {filteredWords.map((word, idx) => (
                                        <div key={idx} className="bg-white rounded-lg border border-slate-200 shadow-sm hover:shadow-md hover:border-yellow-400 transition-all flex flex-col group">
                                            <div className="p-4 bg-white border-b border-slate-100 relative">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <h3 className="text-xl font-bold text-slate-900">{word.es_term}</h3>
                                                        <div className="flex items-center gap-2 mt-1">
                                                            {word.level && <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded text-white ${['A1','A2'].includes(word.level) ? 'bg-green-500' : ['B1','B2'].includes(word.level) ? 'bg-blue-500' : 'bg-purple-500'}`}>{word.level}</span>}
                                                            <span className="text-xs px-1.5 py-0.5 bg-yellow-100 text-yellow-800 rounded font-medium">ES</span>
                                                            <span className="text-sm font-mono text-slate-500">{word.phonetic || '-'}</span>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleSpeak(word.es_term);
                                                        }}
                                                        className="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors opacity-100 md:opacity-0 md:group-hover:opacity-100"
                                                        title="Escuchar"
                                                    >
                                                        <Icon name="volume" size={20} />
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="p-4 flex-1">
                                                <div className="mb-3">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className="text-[10px] px-1 bg-blue-50 text-blue-600 rounded border border-blue-100">EN</span>
                                                        <span className="font-semibold text-slate-700">{word.en_term}</span>
                                                    </div>
                                                    <p className="text-slate-600">{word.definition}</p>
                                                </div>
                                                {word.context && <div className="bg-slate-50 p-3 rounded border border-slate-100 text-sm text-slate-500 italic">"{word.context}"</div>}
                                            </div>
                                            <div className="px-4 py-3 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
                                                <div className="flex flex-wrap gap-1">
                                                    {word.tags.map(tag => (
                                                        <span key={tag} className={`text-[10px] px-2 py-0.5 rounded-full border ${selectedTags.includes(tag) ? 'bg-yellow-100 text-yellow-800 border-yellow-200' : 'bg-white text-slate-500 border-slate-200'}`}>{tag}</span>
                                                    ))}
                                                </div>
                                                <span className="text-[9px] text-slate-300 font-mono">{word.sourceFile}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="flex flex-col items-center justify-center h-64 text-slate-400">
                                    {isLoading ? <Icon name="refresh" className="animate-spin mb-4" size={48} /> : <Icon name="filter" size={48} className="mb-4 opacity-20" />}
                                    <p>{isLoading ? '正在扫描文件...' : '没有符合筛选条件的单词'}</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Status Modal */}
                    {showStatusModal && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]">
                                <div className="p-4 border-b border-slate-100 flex justify-between items-center">
                                    <h3 className="font-bold text-lg">文件加载状态 (00.json ~ 99.json)</h3>
                                    <button onClick={() => setShowStatusModal(false)}><Icon name="x" size={24} /></button>
                                </div>
                                <div className="p-4 overflow-y-auto bg-slate-50 custom-scrollbar">
                                    <div className="space-y-2">
                                        {FILE_SLOTS.map(slot => {
                                            const status = fileStatus[slot.id];
                                            if (status?.status === 'missing' || !status) return null;
                                            const isOk = status.status === 'ok';
                                            return (
                                                <div key={slot.id} className={`flex items-center justify-between p-3 rounded-lg border ${isOk ? 'bg-white border-green-200' : 'bg-red-50 border-red-200'}`}>
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center font-mono font-bold text-sm ${isOk ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{slot.fileName.split('.')[0]}</div>
                                                        <div>
                                                            <div className="font-medium text-sm text-slate-900">{slot.fileName}</div>
                                                            <div className="text-xs text-slate-500">{slot.desc}</div>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        {isOk ? (
                                                            <div className="flex items-center gap-1 text-green-600 text-sm"><Icon name="check" size={14}/><span>Loaded {status.count} words</span></div>
                                                        ) : (
                                                            <div className="flex items-center gap-1 text-red-500 text-sm"><Icon name="alert" size={14}/><span>{status.msg}</span></div>
                                                        )}
                                                    </div>
                                                </div>
                                            )
                                        })}
                                        {Object.values(fileStatus).every(s => s.status === 'missing') && <div className="text-center py-8 text-slate-400">所有槽位均为空。请添加 json 文件。</div>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
